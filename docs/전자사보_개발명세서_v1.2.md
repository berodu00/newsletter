# ê³ ë ¤ì•„ì—° ì „ìì‚¬ë³´ ê³ ë„í™” í”„ë¡œì íŠ¸ - ê°œë°œ ëª…ì„¸ì„œ v1.2

## ğŸ“‹ ë¬¸ì„œ ì •ë³´
- **í”„ë¡œì íŠ¸ëª…**: ê³ ë ¤ì•„ì—°(Korea Zinc) ì „ìì‚¬ë³´ ê³ ë„í™” ì‹œìŠ¤í…œ
- **ë¬¸ì„œ ë²„ì „**: v1.2 (DB ì •ì±… ê°•í™” + React ê¸°ë°˜)
- **ì‘ì„±ì¼**: 2025-12-26
- **ê°œë°œ ë°©ì‹**: Vibe Coding (Gemini 3 Pro + Google AntiGravity)
- **ëŒ€ìƒ ì‚¬ìš©ì**: ê³ ë ¤ì•„ì—° ë° ê³„ì—´ì‚¬ ì„ì§ì›
- **DBMS**: PostgreSQL 15+
- **ë§ˆì´ê·¸ë ˆì´ì…˜**: **Flyway í•„ìˆ˜** (DDL ì§ì ‘ ìˆ˜ì • ê¸ˆì§€)

### ğŸ“ v1.2 ì£¼ìš” ë³€ê²½ì‚¬í•­
1. **ë°ì´í„°ë² ì´ìŠ¤ ìš´ì˜ ì›ì¹™ ì •ë¦½**: Soft Delete, Audit, ì •í•©ì„± ì •ì±… ëª…ì‹œ
2. **ì¡°íšŒìˆ˜ ì¤‘ë³µ ë°©ì§€ ê°•í™”**: TTL ê¸°ë°˜ dedup í…Œì´ë¸” ì¶”ê°€ (30ë¶„ 1íšŒ ì œí•œ)
3. **ë°˜ì‘ ì •ì±… í™•ì •**: ë‹¨ì¼ ì„ íƒ + í† ê¸€ ë°©ì‹ìœ¼ë¡œ ê³ ì •
4. **ì»¨í…ì¸  ìƒíƒœ ëª¨ë¸ í™•ì¥**: SCHEDULED ì¶”ê°€ (ì˜ˆì•½ ë°œí–‰ ì§€ì›)
5. **ì´ë²¤íŠ¸/íŒì—… ê¸°ê°„ì„ TIMESTAMPë¡œ í™•ì •**: ì‹œê°„ ë‹¨ìœ„ ì œì–´ ê°€ëŠ¥
6. **íŒŒì¼ ê´€ë¦¬ ê°•í™”**: UUID íŒŒì¼ëª…, SHA256 ë¬´ê²°ì„± ê²€ì¦
7. **Audit Log ì¶”ê°€**: ëª¨ë“  ê´€ë¦¬ì í–‰ë™ ì¶”ì 
8. **ì „ë¬¸ ê²€ìƒ‰(FTS) ì§€ì›**: PostgreSQL tsvector ê¸°ë°˜
9. **í•´ì‹œíƒœê·¸ ì •í•©ì„± ë³´ì¥**: íŠ¸ëœì­ì…˜ ì¦ê° + ì•¼ê°„ ì¬ì§‘ê³„
10. **Flyway ë§ˆì´ê·¸ë ˆì´ì…˜ ì˜ë¬´í™”**: ìŠ¤í‚¤ë§ˆ ë³€ê²½ ì´ë ¥ ê´€ë¦¬

---

## 1. í”„ë¡œì íŠ¸ ê°œìš”

### 1.1 ì¶”ì§„ ë°°ê²½
- **ë…¸í›„ ì‹œìŠ¤í…œ ê°œì„ **: ì˜¤ë˜ëœ ì‹œìŠ¤í…œìœ¼ë¡œ ìµœì‹  ë¸Œë¼ìš°ì € í™˜ê²½ ë¶€ì í•©, PDF ì¤‘ì‹¬ì˜ ì œí•œì  ì—´ëŒ
- **ëª¨ë°”ì¼ ì ‘ê·¼ì„± ë¶€ì¬**: ë‚´ë¶€ë§ ì „ìš©ìœ¼ë¡œ ì™¸ë¶€ ë„¤íŠ¸ì›Œí¬(ì¶œí‡´ê·¼ê¸¸ ë“±)ì—ì„œ ì ‘ê·¼ ë¶ˆê°€
- **ì†Œì…œ ì»¨í…ì¸  ì¦ê°€**: ê³ ë ¤ì•„ì—° YouTube, Instagram ë“± SNS ì»¨í…ì¸  í‘œì‹œ ì‹œìŠ¤í…œ ë¶€ì¬
- **ë¶„ì„ ì²´ê³„ ë¯¸ë¹„**: ì‚¬ë³´ ì†Œë¹„ìœ¨ ê°ì†Œ ë° ë°©ë¬¸ì/ì¡°íšŒìˆ˜ ë¶„ì„ ë„êµ¬ ë¶€ì¬

### 1.2 í”„ë¡œì íŠ¸ ëª©í‘œ
ì›¹ ê¸°ë°˜ ë°˜ì‘í˜• SPA(Single Page Application)ë¡œ ì „í™˜í•˜ì—¬ **ì‚¬ë³´ ì—´ëŒ + SNS ì»¨í…ì¸  + ì„ì§ì› ì°¸ì—¬**ë¥¼ í†µí•©í•œ **ì»¤ë®¤ë‹ˆí‹° í”Œë«í¼** êµ¬ì¶•

### 1.3 í”„ë¡œì íŠ¸ ë²”ìœ„
**ì´ë²ˆ í”„ë¡œì íŠ¸ëŠ” "ì „ì ì‚¬ë³´ ì‹œìŠ¤í…œ"ë§Œ êµ¬ì¶•í•©ë‹ˆë‹¤.**
- ë™í˜¸íšŒ ê´€ë¦¬ ì‹œìŠ¤í…œ
- íŠ¹í—ˆ ê´€ë¦¬ ì‹œìŠ¤í…œ
- ê³µì§€ ê´€ë¦¬ ì‹œìŠ¤í…œ
â†’ ìœ„ 3ê°œ ì‹œìŠ¤í…œì€ í–¥í›„ í™•ì¥ ê³„íšìœ¼ë¡œ ë³„ë„ ì¶”ì§„ ì˜ˆì •

---

## 2. ê¸°ìˆ  ìŠ¤íƒ

### 2.1 ê°œë°œ í™˜ê²½
- **ë¡œì»¬ PC ê°œë°œ**: ë¡œì»¬ í™˜ê²½ì—ì„œ ì¦‰ì‹œ ì‹¤í–‰ ê°€ëŠ¥í•˜ë„ë¡ êµ¬ì„±
- **íƒ€ê²Ÿ í™˜ê²½**: PC í¼ìŠ¤íŠ¸ + ëª¨ë°”ì¼ ë°˜ì‘í˜• SPA

### 2.2 ê¸°ìˆ  ìŠ¤íƒ ìƒì„¸

| êµ¬ë¶„ | ê¸°ìˆ  | ë²„ì „ | ë¹„ê³  |
|------|------|------|------|
| **Backend** | JAVA | 17+ | |
| | Spring Boot | 3.2+ | RESTful API ì„œë²„ |
| | Gradle | 8.x | ë¹Œë“œ ë„êµ¬ |
| | Spring Security | 6.x | OAuth 2.0 ì¸ì¦ |
| | Spring Data JPA | 3.x | ORM |
| | Flyway | 10+ | ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ (í•„ìˆ˜) |
| **Database** | PostgreSQL | 15+ | ë©”ì¸ ë°ì´í„°ë² ì´ìŠ¤ |
| **Frontend** | React | 18+ | SPA í”„ë ˆì„ì›Œí¬ |
| | React Router | 6+ | í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ ë¼ìš°íŒ… |
| | Axios | 1.x | HTTP í´ë¼ì´ì–¸íŠ¸ |
| | Bootstrap | 5.3+ | ë°˜ì‘í˜• UI |
| | React-Bootstrap | 2.x | Reactìš© Bootstrap |
| | Vite | 5+ | ë¹Œë“œ ë„êµ¬ |
| **Rich Text Editor** | React-Quill | 2.x | HTML ì—ë””í„° |
| **Chart Library** | Recharts | 2.x | ì°¨íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ |
| **State Management** | React Context API | - | ì „ì—­ ìƒíƒœ ê´€ë¦¬ |
| **External API** | YouTube Data API | v3 | ìœ íŠœë¸Œ ì»¨í…ì¸  ìˆ˜ì§‘ |
| | Instagram Graph API | - | ì¸ìŠ¤íƒ€ê·¸ë¨ ì»¨í…ì¸  ìˆ˜ì§‘ |
| | Naver Analytics | - | ë°©ë¬¸ì í†µê³„ |
| **File Storage** | ë¡œì»¬ íŒŒì¼ì‹œìŠ¤í…œ | - | ê°œë°œ/í…ŒìŠ¤íŠ¸ (ìš´ì˜ì€ S3 í˜¸í™˜) |
| **Version Control** | Git | - | AI íƒœê·¸ ì»¤ë°‹ |
| **Recording** | OBS Studio | - | ê°œë°œ ê³¼ì • ë…¹í™” |

### 2.3 ì•„í‚¤í…ì²˜ íŒ¨í„´
- **ë°±ì—”ë“œ**: RESTful API (JSON)
- **í”„ë¡ íŠ¸ì—”ë“œ**: SPA (React) - CSR
- **ì¸ì¦**: OAuth 2.0 (OIDC) + JWT
- **í†µì‹ **: CORS ì„¤ì •
- **ë§ˆì´ê·¸ë ˆì´ì…˜**: Flyway (DDL ì§ì ‘ ìˆ˜ì • ê¸ˆì§€)

---

## 3. ë°ì´í„°ë² ì´ìŠ¤ ìš´ì˜ ì›ì¹™

### 3.1 ë‹¨ì¼ ì§„ì‹¤ ì›ì²œ (Single Source of Truth)
- **ì»¨í…ì¸ /ì´ë²¤íŠ¸/íŒì—…/ì•„ì´ë””ì–´/í•´ì‹œíƒœê·¸/ë°˜ì‘/ë³„ì **ì€ ëª¨ë‘ **DBë¥¼ ì§„ì‹¤ ì›ì²œ**ìœ¼ë¡œ í•œë‹¤.
- íŠ¸ë˜í”½ ë¶„ì„(ìœ ì…ê²½ë¡œ/ë¸Œë¼ìš°ì € ë“±)ì€ Analyticsë¡œ ìœ„ì„í•˜ë˜, **ì—…ë¬´ ì§€í‘œ(ì¡°íšŒìˆ˜/ë°˜ì‘/ë³„ì /ì°¸ì—¬)ëŠ” DBê°€ ê³µì‹ ìˆ˜ì¹˜**

### 3.2 Soft Delete ì›ì¹™
**í•µì‹¬ ì—”í‹°í‹°ëŠ” Soft Delete ê¸°ë³¸**:
- ëŒ€ìƒ: `contents`, `events`, `ideas`, `resource_files`, `social_contents`
- ì´ìœ : í†µê³„/ê°ì‚¬/ë³µêµ¬ ì´ìŠˆ ì°¨ë‹¨
- ì»¬ëŸ¼: `deleted_at TIMESTAMP`, `deleted_by BIGINT`

**Hard Delete í—ˆìš©**:
- ëŒ€ìƒ: ì—°ê²° í…Œì´ë¸” (`content_hashtags`, `reactions`, `ratings`, `event_participants`)
- ë‹¨, `audit_logs`ë¡œ ì¶”ì  ê°€ëŠ¥

### 3.3 ê°ì‚¬/ì¶”ì  (Audit) ì •ì±…
**ëª¨ë“  ë³€ê²½ ì´ë ¥ì„ DBì—ì„œ ë³´ì¥**:
- ëª¨ë“  í…Œì´ë¸”ì— ê³µí†µ ì»¬ëŸ¼:
  - `created_at`, `created_by`, `updated_at`, `updated_by`
  - Soft Delete ëŒ€ìƒ: `deleted_at`, `deleted_by`
- ëª¨ë“  ê´€ë¦¬ì CRUDëŠ” `audit_logs` í…Œì´ë¸”ì— append-onlyë¡œ ê¸°ë¡
- `audit_logs`ëŠ” **ìˆ˜ì •/ì‚­ì œ ê¸ˆì§€** (ë³´ê´€ ê¸°ê°„: 1ë…„)

### 3.4 ì •í•©ì„±/ë™ì‹œì„± ì •ì±…
**ëª¨ë“  ì‚¬ìš©ì ì…ë ¥ ê¸°ë°˜ ì§‘ê³„ëŠ” ì¤‘ë³µ ë°©ì§€ í‚¤ ì‚¬ìš©**:
- **ì¡°íšŒìˆ˜**: `content_views_dedup` í…Œì´ë¸” ê¸°ë°˜ (TTL 30ë¶„)
- **ë°˜ì‘/ë³„ì **: `UNIQUE` ì œì•½ + Upsert
- **ì´ë²¤íŠ¸ ì°¸ì—¬**: `UNIQUE(event_id, user_id)` + Upsert
- **í•´ì‹œíƒœê·¸ ì‚¬ìš© íšŸìˆ˜**: íŠ¸ëœì­ì…˜ ë‚´ ì¦ê° + ì•¼ê°„ ì¬ì§‘ê³„

### 3.5 í•´ì‹œíƒœê·¸ ì§‘ê³„ ì •í•©ì„± ë³´ì¥
`hashtags.usage_count`ëŠ” **ì •í•©ì„± ë³´ì¥ ê°’**:
- **ì‹¤ì‹œê°„ ì •í•©ì„±**: ì»¨í…ì¸ -íƒœê·¸ ë³€ê²½ ì‹œ íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ `usage_count` ì¦ê°
- **ì¼ì¼ ì •í•©ì„± ë³´ì •**: ì•¼ê°„ ë°°ì¹˜ë¡œ `content_hashtags` ê¸°ì¤€ ì¬ì§‘ê³„ â†’ ì˜¤ì°¨ 0

### 3.6 ì¡°íšŒìˆ˜ ì •ì±… (ì¤‘ë³µ ì¦ê°€ ë°©ì§€)
**TTL ê¸°ë°˜ dedup ë°©ì‹**:
- ì»¨í…ì¸  ìƒì„¸ í˜ì´ì§€ ì§„ì… ì‹œ ì¡°íšŒìˆ˜ ì¦ê°€
- ë™ì¼ ì‚¬ìš©ìê°€ ë™ì¼ ì»¨í…ì¸ ë¥¼ **30ë¶„ ì´ë‚´** ì¬ì¡°íšŒ ì‹œ ì¹´ìš´íŠ¸ ì•ˆ í•¨
- êµ¬í˜„: `content_views_dedup` í…Œì´ë¸” (30ë¶„ ë²„í‚· ë‹¨ìœ„)
- TTLì€ ìš´ì˜ ì„¤ì •ìœ¼ë¡œ ì¡°ì • ê°€ëŠ¥ (ê¸°ë³¸ê°’: 30ë¶„)

### 3.7 ì„±ëŠ¥/ì¸ë±ìŠ¤ ì •ì±…
**ëª¨ë“  ëª©ë¡/ê²€ìƒ‰/í•„í„°/ì •ë ¬ APIëŠ” ì¸ë±ìŠ¤ë¡œ ì»¤ë²„**:
- ë³µí•© ì¸ë±ìŠ¤ ì ê·¹ í™œìš©
- PostgreSQL Full-Text Search (tsvector) ì‚¬ìš©
  - ëŒ€ìƒ: `title + summary + body_text` (HTML ì œê±° í…ìŠ¤íŠ¸)
- `EXPLAIN ANALYZE`ë¡œ ì¿¼ë¦¬ ì„±ëŠ¥ ê²€ì¦

### 3.8 Flyway ë§ˆì´ê·¸ë ˆì´ì…˜ ì˜ë¬´í™”
**ëª¨ë“  ìŠ¤í‚¤ë§ˆ ë³€ê²½ì€ Flyway ë§ˆì´ê·¸ë ˆì´ì…˜ìœ¼ë¡œë§Œ ìˆ˜í–‰**:
- DDL ì§ì ‘ ìˆ˜ì • ê¸ˆì§€
- ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ìœ„ì¹˜: `src/main/resources/db/migration/`
- íŒŒì¼ëª… í˜•ì‹: `V{version}__{description}.sql`
  - ì˜ˆ: `V1__create_initial_schema.sql`
  - ì˜ˆ: `V2__add_audit_logs.sql`
- Rollback í•„ìš” ì‹œ ìƒˆë¡œìš´ ë²„ì „ìœ¼ë¡œ ì‘ì„± (ì˜ˆ: `V3__rollback_feature.sql`)

---

## 4. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ (v1.2)

> ì•„ë˜ SQLì€ "ì„¤ê³„ ê¸°ì¤€"ì´ë©° ì‹¤ì œ ì ìš©ì€ Flyway ë§ˆì´ê·¸ë ˆì´ì…˜ìœ¼ë¡œ ì§„í–‰  
> í‘œì¤€: `BIGSERIAL` (PK), ëª¨ë“  FKëŠ” ëª…ì‹œì  `ON DELETE` ì •ì±… ë¶€ì—¬

### 4.1 users (ì‚¬ìš©ì)

```sql
CREATE TABLE users (
  user_id        BIGSERIAL PRIMARY KEY,
  username       VARCHAR(100) NOT NULL UNIQUE,   -- SSO ì‹ë³„ì (ì‚¬ë²ˆ/ê³„ì •)
  name           VARCHAR(100) NOT NULL,
  email          VARCHAR(255),
  department     VARCHAR(100),
  role           VARCHAR(20) NOT NULL DEFAULT 'USER',  -- USER, ADMIN

  is_active      BOOLEAN NOT NULL DEFAULT TRUE,

  created_at     TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  created_by     BIGINT REFERENCES users(user_id),
  updated_at     TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_by     BIGINT REFERENCES users(user_id),
  last_login_at  TIMESTAMP,

  deleted_at     TIMESTAMP,
  deleted_by     BIGINT REFERENCES users(user_id)
);

CREATE INDEX idx_users_username ON users(username);
CREATE INDEX idx_users_role ON users(role) WHERE deleted_at IS NULL;

COMMENT ON TABLE users IS 'ì‚¬ìš©ì ì •ë³´ (Soft Delete)';
COMMENT ON COLUMN users.is_active IS 'í™œì„± ìƒíƒœ (ë¹„í™œì„±í™” ìš°ì„ , ì‚­ì œ ìµœì†Œí™”)';
```

**ìš´ì˜ ì •ì±…**:
- ì‚¬ìš©ì ì‚­ì œëŠ” ê¸ˆì§€ (Soft Delete), ë¹„í™œì„±í™”(`is_active=false`) ìš°ì„ 
- `created_by`, `updated_by`ëŠ” ì‹œìŠ¤í…œ ì‚¬ìš©ì ID(ì˜ˆ: 0) ë˜ëŠ” NULL í—ˆìš©

---

### 4.2 categories (ì¹´í…Œê³ ë¦¬)

```sql
CREATE TABLE categories (
  category_id    BIGSERIAL PRIMARY KEY,
  category_name  VARCHAR(50) NOT NULL UNIQUE,
  display_order  INT NOT NULL DEFAULT 0,
  is_active      BOOLEAN NOT NULL DEFAULT TRUE,

  created_at     TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  created_by     BIGINT REFERENCES users(user_id),
  updated_at     TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_by     BIGINT REFERENCES users(user_id)
);

CREATE INDEX idx_categories_display_order ON categories(display_order);

-- ì´ˆê¸° ë°ì´í„°
INSERT INTO categories (category_name, display_order, created_by) VALUES
('Special', 1, NULL),
('People', 2, NULL),
('Life', 3, NULL);

COMMENT ON TABLE categories IS 'ì‚¬ë³´ ì¹´í…Œê³ ë¦¬ ë§ˆìŠ¤í„°';
```

---

### 4.3 contents (ì‚¬ë³´ ì»¨í…ì¸ )

```sql
CREATE TABLE contents (
  content_id      BIGSERIAL PRIMARY KEY,

  title           VARCHAR(255) NOT NULL,
  summary         TEXT,                           -- 2ì¤„ ë¯¸ë§Œ ìš”ì•½
  body_html       TEXT NOT NULL,                  -- HTML ë³¸ë¬¸ (Sanitized)
  body_text       TEXT,                           -- ê²€ìƒ‰ìš© í…ìŠ¤íŠ¸ (HTML ì œê±°)

  thumbnail_file_id BIGINT REFERENCES resource_files(file_id),
  category_id     BIGINT NOT NULL REFERENCES categories(category_id),

  -- ìƒíƒœ ëª¨ë¸ (v1.2 í™•ì¥)
  status          VARCHAR(20) NOT NULL DEFAULT 'DRAFT',
  -- DRAFT(ì„ì‹œì €ì¥), PUBLISHED(ë°œí–‰), SCHEDULED(ì˜ˆì•½ë°œí–‰), ARCHIVED(ë³´ê´€)

  author_id       BIGINT NOT NULL REFERENCES users(user_id),
  published_at    TIMESTAMP,                      -- ì‹¤ì œ ê³µê°œ ì‹œê°

  -- ê°ì‚¬ ì¶”ì 
  created_at      TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  created_by      BIGINT REFERENCES users(user_id),
  updated_at      TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_by      BIGINT REFERENCES users(user_id),

  -- Soft Delete
  deleted_at      TIMESTAMP,
  deleted_by      BIGINT REFERENCES users(user_id),

  -- ì§‘ê³„ ìºì‹œ (íŠ¸ëœì­ì…˜ìœ¼ë¡œ ì •í•©ì„± ë³´ì¥)
  view_count      BIGINT NOT NULL DEFAULT 0,
  rating_count    BIGINT NOT NULL DEFAULT 0,
  rating_sum      BIGINT NOT NULL DEFAULT 0,
  average_rating  DECIMAL(3,2) NOT NULL DEFAULT 0.00,

  CONSTRAINT chk_status CHECK (status IN ('DRAFT', 'PUBLISHED', 'SCHEDULED', 'ARCHIVED'))
);

CREATE INDEX idx_contents_category_status_pub 
  ON contents(category_id, status, published_at DESC) WHERE deleted_at IS NULL;

CREATE INDEX idx_contents_status_pub 
  ON contents(status, published_at DESC) WHERE deleted_at IS NULL;

CREATE INDEX idx_contents_view_count 
  ON contents(view_count DESC) WHERE status = 'PUBLISHED' AND deleted_at IS NULL;

COMMENT ON TABLE contents IS 'ì‚¬ë³´ ì»¨í…ì¸  (Soft Delete)';
COMMENT ON COLUMN contents.status IS 'DRAFT: ì„ì‹œì €ì¥, PUBLISHED: ë°œí–‰, SCHEDULED: ì˜ˆì•½ë°œí–‰, ARCHIVED: ë³´ê´€';
```

**ë…¸ì¶œ ì •ì±…**:
- ì‚¬ìš©ì: `status='PUBLISHED'` AND `deleted_at IS NULL`
- ì˜ˆì•½ ë°œí–‰: `status='SCHEDULED'` + `published_at` ë„ë˜ ì‹œ ë°°ì¹˜ê°€ `PUBLISHED`ë¡œ ì „í™˜

---

### 4.4 content_search (ì „ë¬¸ ê²€ìƒ‰)

```sql
CREATE TABLE content_search (
  content_id      BIGINT PRIMARY KEY REFERENCES contents(content_id) ON DELETE CASCADE,
  search_vector   tsvector NOT NULL
);

CREATE INDEX idx_content_search_vector ON content_search USING GIN (search_vector);

COMMENT ON TABLE content_search IS 'ì»¨í…ì¸  ì „ë¬¸ ê²€ìƒ‰ (PostgreSQL FTS)';
COMMENT ON COLUMN content_search.search_vector IS 'title + summary + body_text ê¸°ë°˜ tsvector';
```

**ì—…ë°ì´íŠ¸ ë°©ì‹**:
- ì»¨í…ì¸  ì €ì¥/ìˆ˜ì • ì‹œ `body_text` ìƒì„± â†’ `to_tsvector('korean', title || ' ' || summary || ' ' || body_text)` ì €ì¥
- ê²€ìƒ‰: `WHERE search_vector @@ to_tsquery('korean', 'query')`

---

### 4.5 hashtags / content_hashtags

```sql
CREATE TABLE hashtags (
  hashtag_id     BIGSERIAL PRIMARY KEY,
  hashtag_name   VARCHAR(50) NOT NULL UNIQUE,
  usage_count    BIGINT NOT NULL DEFAULT 0,      -- ì •í•©ì„± ë³´ì¥ ê°’

  created_at     TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  created_by     BIGINT REFERENCES users(user_id),
  updated_at     TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_by     BIGINT REFERENCES users(user_id)
);

CREATE INDEX idx_hashtags_usage_count ON hashtags(usage_count DESC);

CREATE TABLE content_hashtags (
  content_id     BIGINT NOT NULL REFERENCES contents(content_id) ON DELETE CASCADE,
  hashtag_id     BIGINT NOT NULL REFERENCES hashtags(hashtag_id) ON DELETE RESTRICT,
  created_at     TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  created_by     BIGINT REFERENCES users(user_id),
  PRIMARY KEY(content_id, hashtag_id)
);

CREATE INDEX idx_content_hashtags_hashtag ON content_hashtags(hashtag_id);

COMMENT ON TABLE hashtags IS 'í•´ì‹œíƒœê·¸ ë§ˆìŠ¤í„°';
COMMENT ON COLUMN hashtags.usage_count IS 'ì •í•©ì„± ë³´ì¥ ê°’ (íŠ¸ëœì­ì…˜ ì¦ê° + ì•¼ê°„ ì¬ì§‘ê³„)';
```

**ì •í•©ì„± ë³´ì¥ ì •ì±…**:
1. **ì‹¤ì‹œê°„**: ì»¨í…ì¸  ì €ì¥/ìˆ˜ì • ì‹œ íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ
   - ê¸°ì¡´ `content_hashtags` ì‚­ì œ â†’ í•´ë‹¹ `hashtag.usage_count -= 1`
   - ì‹ ê·œ `content_hashtags` ìƒì„± â†’ í•´ë‹¹ `hashtag.usage_count += 1`
2. **ì¼ì¼ ë³´ì •**: ì•¼ê°„ ë°°ì¹˜ë¡œ ì¬ì§‘ê³„
   ```sql
   UPDATE hashtags SET usage_count = (
     SELECT COUNT(*) FROM content_hashtags WHERE hashtag_id = hashtags.hashtag_id
   );
   ```

---

### 4.6 ratings (ë³„ì )

```sql
CREATE TABLE ratings (
  rating_id     BIGSERIAL PRIMARY KEY,
  content_id    BIGINT NOT NULL REFERENCES contents(content_id) ON DELETE CASCADE,
  user_id       BIGINT NOT NULL REFERENCES users(user_id),
  rating_value  INT NOT NULL CHECK (rating_value BETWEEN 1 AND 5),

  created_at    TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  created_by    BIGINT REFERENCES users(user_id),
  updated_at    TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_by    BIGINT REFERENCES users(user_id),

  UNIQUE(content_id, user_id)
);

CREATE INDEX idx_ratings_content ON ratings(content_id);

COMMENT ON TABLE ratings IS 'ë³„ì  (ì‚¬ìš©ìë‹¹ ì»¨í…ì¸  1ê°œ, Upsert)';
```

**ë™ì‘ ì •ì±…**:
- ì‚¬ìš©ìë‹¹ ì»¨í…ì¸  1ê°œ ë³„ì  ë¶€ì—¬
- ì¬í‰ê°€ ì‹œ `UPDATE` (Upsert)
- íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ `contents`ì˜ ì§‘ê³„ ìºì‹œ ê°±ì‹ :
  ```sql
  -- INSERT/UPDATE í›„
  UPDATE contents SET
    rating_count = (SELECT COUNT(*) FROM ratings WHERE content_id = ?),
    rating_sum = (SELECT SUM(rating_value) FROM ratings WHERE content_id = ?),
    average_rating = ROUND(rating_sum::numeric / NULLIF(rating_count, 0), 2)
  WHERE content_id = ?;
  ```

---

### 4.7 reactions (ë°˜ì‘ ì´ëª¨ì§€)

```sql
CREATE TABLE reactions (
  reaction_id    BIGSERIAL PRIMARY KEY,
  content_id     BIGINT NOT NULL REFERENCES contents(content_id) ON DELETE CASCADE,
  user_id        BIGINT NOT NULL REFERENCES users(user_id),

  reaction_type  VARCHAR(20) NOT NULL,           -- LIKE, SAD, ANGRY, FUNNY

  created_at     TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  created_by     BIGINT REFERENCES users(user_id),
  updated_at     TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_by     BIGINT REFERENCES users(user_id),

  UNIQUE(content_id, user_id),
  CONSTRAINT chk_reaction_type CHECK (reaction_type IN ('LIKE', 'SAD', 'ANGRY', 'FUNNY'))
);

CREATE INDEX idx_reactions_content ON reactions(content_id);

COMMENT ON TABLE reactions IS 'ë°˜ì‘ ì´ëª¨ì§€ (ë‹¨ì¼ ì„ íƒ + í† ê¸€)';
```

**ì •ì±… í™•ì • (v1.2)**:
- **ë‹¨ì¼ ì„ íƒ**: ì‚¬ìš©ìëŠ” LIKE/SAD/ANGRY/FUNNY ì¤‘ **1ê°œë§Œ** ì„ íƒ ê°€ëŠ¥
- **í† ê¸€ ë°©ì‹**:
  - ê°™ì€ íƒ€ì… ì¬í´ë¦­: `DELETE` (ì·¨ì†Œ)
  - ë‹¤ë¥¸ íƒ€ì… í´ë¦­: `UPDATE reaction_type`
- **ë‹¤ì¤‘ ì„ íƒ ë¶ˆê°€**: `UNIQUE(content_id, user_id)` ì œì•½ìœ¼ë¡œ ê°•ì œ

**API ë™ì‘**:
```javascript
POST /api/contents/{id}/reaction
Body: { "reactionType": "LIKE" }

// ë¡œì§
1. ê¸°ì¡´ ë°˜ì‘ ì¡°íšŒ
2. ì—†ìœ¼ë©´ INSERT
3. ê°™ì€ íƒ€ì…ì´ë©´ DELETE (í† ê¸€ off)
4. ë‹¤ë¥¸ íƒ€ì…ì´ë©´ UPDATE (ë³€ê²½)
```

---

### 4.8 content_views_dedup (ì¡°íšŒìˆ˜ ì¤‘ë³µ ë°©ì§€)

```sql
CREATE TABLE content_views_dedup (
  content_id    BIGINT NOT NULL REFERENCES contents(content_id) ON DELETE CASCADE,
  user_id       BIGINT NOT NULL REFERENCES users(user_id),
  viewed_bucket TIMESTAMP NOT NULL,              -- 30ë¶„ ë‹¨ìœ„ ë²„í‚· ì‹œì‘ ì‹œê°
  created_at    TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY(content_id, user_id, viewed_bucket)
);

CREATE INDEX idx_content_views_dedup_content ON content_views_dedup(content_id);
CREATE INDEX idx_content_views_dedup_created ON content_views_dedup(created_at);

COMMENT ON TABLE content_views_dedup IS 'ì¡°íšŒìˆ˜ ì¤‘ë³µ ë°©ì§€ (TTL 30ë¶„)';
COMMENT ON COLUMN content_views_dedup.viewed_bucket IS '30ë¶„ ë²„í‚· (TIMESTAMP TRUNCATE TO 30min)';
```

**ë™ì‘ ë°©ì‹**:
1. ì‚¬ìš©ìê°€ ì»¨í…ì¸  ìƒì„¸ ì¡°íšŒ
2. í˜„ì¬ ì‹œê°ì„ 30ë¶„ ë²„í‚·ìœ¼ë¡œ ë‚´ë¦¼
   ```sql
   viewed_bucket = DATE_TRUNC('hour', NOW()) + 
                   INTERVAL '30 minutes' * FLOOR(EXTRACT(MINUTE FROM NOW()) / 30);
   ```
3. `INSERT INTO content_views_dedup` ì‹œë„
4. **ì„±ê³µ ì‹œì—ë§Œ** `UPDATE contents SET view_count = view_count + 1`
5. ì‹¤íŒ¨ ì‹œ (ì¤‘ë³µ í‚¤) ì¡°íšŒìˆ˜ ì¦ê°€ ì•ˆ í•¨

**ì •ë¦¬ ì •ì±…**:
- ë³´ê´€ ê¸°ê°„: 90ì¼
- ì›”ë³„ íŒŒí‹°ì…˜ ê¶Œì¥ (`created_at` ê¸°ì¤€)

---

### 4.9 social_contents (SNS ì»¨í…ì¸ )

```sql
CREATE TABLE social_contents (
  social_content_id BIGSERIAL PRIMARY KEY,
  platform          VARCHAR(20) NOT NULL,         -- YOUTUBE, INSTAGRAM
  external_id       VARCHAR(255) NOT NULL,
  title             VARCHAR(255),
  description       TEXT,
  thumbnail_url     VARCHAR(500),
  media_url         VARCHAR(500),
  published_at      TIMESTAMP,
  fetched_at        TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  is_active         BOOLEAN NOT NULL DEFAULT TRUE,

  deleted_at        TIMESTAMP,
  deleted_by        BIGINT REFERENCES users(user_id),

  UNIQUE(platform, external_id),
  CONSTRAINT chk_platform CHECK (platform IN ('YOUTUBE', 'INSTAGRAM'))
);

CREATE INDEX idx_social_contents_platform_pub 
  ON social_contents(platform, published_at DESC) WHERE is_active = TRUE AND deleted_at IS NULL;

COMMENT ON TABLE social_contents IS 'SNS ì»¨í…ì¸  (Soft Delete)';
```

**ë™ê¸°í™” ì •ì±…**:
- Upsertë¡œë§Œ ì²˜ë¦¬ (ì¤‘ë³µ INSERT ê¸ˆì§€)
- `ON CONFLICT (platform, external_id) DO UPDATE`
- ìˆ¨ê¹€ ì²˜ë¦¬: `is_active = false` ë˜ëŠ” `deleted_at` ì„¤ì •

---

### 4.10 events / event_participants

```sql
CREATE TABLE events (
  event_id        BIGSERIAL PRIMARY KEY,
  title           VARCHAR(255) NOT NULL,
  description     TEXT,
  thumbnail_file_id BIGINT REFERENCES resource_files(file_id),

  -- v1.2: TIMESTAMPë¡œ í™•ì •
  start_at        TIMESTAMP NOT NULL,
  end_at          TIMESTAMP NOT NULL,

  status          VARCHAR(20) NOT NULL DEFAULT 'ACTIVE',  -- ACTIVE, INACTIVE, CLOSED
  created_by      BIGINT REFERENCES users(user_id),

  created_at      TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at      TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,

  deleted_at      TIMESTAMP,
  deleted_by      BIGINT REFERENCES users(user_id),

  CONSTRAINT chk_event_period CHECK (end_at > start_at),
  CONSTRAINT chk_event_status CHECK (status IN ('ACTIVE', 'INACTIVE', 'CLOSED'))
);

CREATE INDEX idx_events_status_period 
  ON events(status, start_at, end_at) WHERE deleted_at IS NULL;

CREATE TABLE event_participants (
  participant_id  BIGSERIAL PRIMARY KEY,
  event_id        BIGINT NOT NULL REFERENCES events(event_id) ON DELETE CASCADE,
  user_id         BIGINT NOT NULL REFERENCES users(user_id),
  comment         TEXT,
  is_winner       BOOLEAN NOT NULL DEFAULT FALSE,

  participated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  UNIQUE(event_id, user_id)
);

CREATE INDEX idx_event_participants_event ON event_participants(event_id);
CREATE INDEX idx_event_participants_winner ON event_participants(event_id, is_winner);

COMMENT ON TABLE events IS 'ì´ë²¤íŠ¸ (Soft Delete, TIMESTAMP ê¸°ê°„)';
COMMENT ON TABLE event_participants IS 'ì´ë²¤íŠ¸ ì°¸ì—¬ì (ëœë¤ ì¶”ì²¨ ì§€ì›)';
```

**ì§„í–‰ ì¤‘ íŒë‹¨**:
```sql
WHERE NOW() BETWEEN start_at AND end_at 
  AND status = 'ACTIVE' 
  AND deleted_at IS NULL
```

**ë‹¹ì²¨ì ì¶”ì²¨**:
```sql
UPDATE event_participants SET is_winner = TRUE 
WHERE participant_id IN (
  SELECT participant_id FROM event_participants 
  WHERE event_id = ? AND is_winner = FALSE 
  ORDER BY RANDOM() 
  LIMIT ?
)
```

---

### 4.11 popups (íŒì—…)

```sql
CREATE TABLE popups (
  popup_id       BIGSERIAL PRIMARY KEY,
  title          VARCHAR(255) NOT NULL,
  content        TEXT,
  image_file_id  BIGINT REFERENCES resource_files(file_id),
  link_url       VARCHAR(500),

  -- v1.2: TIMESTAMPë¡œ í™•ì •
  start_at       TIMESTAMP NOT NULL,
  end_at         TIMESTAMP NOT NULL,
  is_active      BOOLEAN NOT NULL DEFAULT TRUE,
  display_order  INT NOT NULL DEFAULT 0,

  created_at     TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  created_by     BIGINT REFERENCES users(user_id),
  updated_at     TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_by     BIGINT REFERENCES users(user_id),

  CONSTRAINT chk_popup_period CHECK (end_at > start_at)
);

CREATE INDEX idx_popups_active_period 
  ON popups(is_active, start_at, end_at, display_order);

COMMENT ON TABLE popups IS 'íŒì—… (TIMESTAMP ê¸°ê°„)';
```

**ë…¸ì¶œ ì¡°ê±´**:
```sql
WHERE NOW() BETWEEN start_at AND end_at 
  AND is_active = TRUE
ORDER BY display_order, popup_id
```

---

### 4.12 ideas (ì•„ì´ë””ì–´ ì œì•ˆ)

```sql
CREATE TABLE ideas (
  idea_id        BIGSERIAL PRIMARY KEY,
  user_id        BIGINT NOT NULL REFERENCES users(user_id),
  title          VARCHAR(255) NOT NULL,
  description    TEXT NOT NULL,

  status         VARCHAR(20) NOT NULL DEFAULT 'PENDING',
  -- PENDING, REVIEWED, ACCEPTED, REJECTED
  admin_comment  TEXT,

  created_at     TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at     TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  reviewed_at    TIMESTAMP,
  reviewed_by    BIGINT REFERENCES users(user_id),

  deleted_at     TIMESTAMP,
  deleted_by     BIGINT REFERENCES users(user_id),

  CONSTRAINT chk_idea_status CHECK (status IN ('PENDING', 'REVIEWED', 'ACCEPTED', 'REJECTED'))
);

CREATE INDEX idx_ideas_status_created 
  ON ideas(status, created_at DESC) WHERE deleted_at IS NULL;

COMMENT ON TABLE ideas IS 'ì•„ì´ë””ì–´ ì œì•ˆ (Soft Delete)';
```

---

### 4.13 resource_files (íŒŒì¼ ê´€ë¦¬)

```sql
CREATE TABLE resource_files (
  file_id        BIGSERIAL PRIMARY KEY,

  original_name  VARCHAR(255) NOT NULL,
  stored_name    VARCHAR(255) NOT NULL UNIQUE,   -- UUID ê¸°ë°˜
  file_path      VARCHAR(500) NOT NULL,          -- /uploads/yyyy/mm/uuid.ext
  file_size      BIGINT NOT NULL,
  mime_type      VARCHAR(100) NOT NULL,
  sha256         VARCHAR(64) NOT NULL,           -- ì¤‘ë³µ ê²€ì¶œ/ë¬´ê²°ì„± ê²€ì¦

  uploaded_by    BIGINT REFERENCES users(user_id),
  uploaded_at    TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,

  deleted_at     TIMESTAMP,
  deleted_by     BIGINT REFERENCES users(user_id)
);

CREATE INDEX idx_resource_files_uploaded_at ON resource_files(uploaded_at DESC);
CREATE INDEX idx_resource_files_sha256 ON resource_files(sha256);

COMMENT ON TABLE resource_files IS 'ì—…ë¡œë“œ íŒŒì¼ (UUID íŒŒì¼ëª…, SHA256 ë¬´ê²°ì„±, Soft Delete)';
```

**íŒŒì¼ ì—…ë¡œë“œ ì •ì±… (v1.2 ê°•í™”)**:
1. **í™•ì¥ì í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸**: `.jpg, .jpeg, .png, .gif, .webp`
2. **MIME íƒ€ì… ê²€ì¦**: íŒŒì¼ í—¤ë” í™•ì¸ (Magic Number)
3. **íŒŒì¼ëª… ìƒì„±**: UUID v4 + í™•ì¥ì
4. **ì €ì¥ ê²½ë¡œ**: `/uploads/YYYY/MM/{uuid}.{ext}`
5. **SHA256 ê³„ì‚°**: ì¤‘ë³µ íŒŒì¼ ê²€ì¶œ ë° ë¬´ê²°ì„± ê²€ì¦
6. **í¬ê¸° ì œí•œ**: 5MB (ì„¤ì • ê°€ëŠ¥)

**ì¤‘ë³µ íŒŒì¼ ì²˜ë¦¬**:
- ê°™ì€ SHA256ì´ ì´ë¯¸ ì¡´ì¬í•˜ë©´:
  - (A) ê¸°ì¡´ íŒŒì¼ ì¬ì‚¬ìš© (ê¶Œì¥)
  - (B) ë³„ë„ ì €ì¥ í›„ ê²½ê³ 

---

### 4.14 audit_logs (ê°ì‚¬ ë¡œê·¸)

```sql
CREATE TABLE audit_logs (
  audit_id      BIGSERIAL PRIMARY KEY,
  actor_user_id BIGINT REFERENCES users(user_id),

  action        VARCHAR(30) NOT NULL,
  -- CREATE, UPDATE, DELETE, PUBLISH, DRAW, LOGIN, LOGOUT, UPLOAD
  
  entity_type   VARCHAR(50) NOT NULL,
  -- CONTENT, EVENT, POPUP, IDEA, FILE, HASHTAG, REACTION, RATING
  
  entity_id     BIGINT,

  before_json   JSONB,                            -- ë³€ê²½ ì „ ìƒíƒœ
  after_json    JSONB,                            -- ë³€ê²½ í›„ ìƒíƒœ

  created_at    TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_audit_logs_entity 
  ON audit_logs(entity_type, entity_id, created_at DESC);

CREATE INDEX idx_audit_logs_actor 
  ON audit_logs(actor_user_id, created_at DESC);

CREATE INDEX idx_audit_logs_created 
  ON audit_logs(created_at DESC);

COMMENT ON TABLE audit_logs IS 'ê°ì‚¬ ë¡œê·¸ (Append-Only, 1ë…„ ë³´ê´€)';
```

**ì •ì±…**:
- **Append-Only**: ìˆ˜ì •/ì‚­ì œ ê¸ˆì§€
- **ë³´ê´€ ê¸°ê°„**: 1ë…„ (ì´í›„ ì•„ì¹´ì´ë¸Œ ë˜ëŠ” ì‚­ì œ)
- **íŒŒí‹°ì…˜**: ì›”ë³„ íŒŒí‹°ì…˜ ê¶Œì¥ (`created_at` ê¸°ì¤€)

**ê¸°ë¡ ëŒ€ìƒ**:
- ëª¨ë“  ê´€ë¦¬ì CRUD (contents, events, popups, ideas)
- íŒŒì¼ ì—…ë¡œë“œ/ì‚­ì œ
- ë‹¹ì²¨ì ì¶”ì²¨
- ì¤‘ìš” ì„¤ì • ë³€ê²½

---

### 4.15 visitor_logs (ë°©ë¬¸ ë¡œê·¸)

```sql
CREATE TABLE visitor_logs (
  log_id        BIGSERIAL PRIMARY KEY,
  user_id       BIGINT REFERENCES users(user_id),
  visited_at    DATE NOT NULL,
  page_views    INT DEFAULT 1,
  UNIQUE(user_id, visited_at)
);

CREATE INDEX idx_visitor_logs_date ON visitor_logs(visited_at DESC);

COMMENT ON TABLE visitor_logs IS 'ë°©ë¬¸ ë¡œê·¸ (ìµœì†Œ ì§‘ê³„, ìƒì„¸ëŠ” Analytics)';
```

**ì •ì±…**:
- ì¼ë³„ ì‚¬ìš©ìë³„ ë°©ë¬¸ ì—¬ë¶€ë§Œ ê¸°ë¡
- ìƒì„¸ ë¶„ì„(ìœ ì… ê²½ë¡œ, ì²´ë¥˜ ì‹œê°„, ë””ë°”ì´ìŠ¤)ì€ Naver Analytics ìœ„ì„

---

## 5. íŠ¸ëœì­ì…˜ ë° ì—…ë°ì´íŠ¸ ê·œì¹™

### 5.1 ì»¨í…ì¸  ì €ì¥/ìˆ˜ì • (í•´ì‹œíƒœê·¸ í¬í•¨)

**ë‹¨ì¼ íŠ¸ëœì­ì…˜ì—ì„œ ìˆ˜í–‰**:
1. `contents` INSERT/UPDATE
2. `body_text` ìƒì„± (HTML íƒœê·¸ ì œê±°)
3. ê¸°ì¡´ `content_hashtags` ì „ëŸ‰ ì‚­ì œ â†’ ê´€ë ¨ `hashtags.usage_count -= 1`
4. ì‹ ê·œ `content_hashtags` ìƒì„± â†’ ê´€ë ¨ `hashtags.usage_count += 1`
5. `content_search.search_vector` ê°±ì‹ 
6. `audit_logs` ê¸°ë¡

### 5.2 ë³„ì  ë“±ë¡/ìˆ˜ì •

**ë‹¨ì¼ íŠ¸ëœì­ì…˜**:
1. `ratings` INSERT/UPDATE (Upsert)
2. `contents.rating_count`, `rating_sum`, `average_rating` ì¬ê³„ì‚°
3. `audit_logs` ê¸°ë¡ (ì„ íƒ)

### 5.3 ë°˜ì‘ ë“±ë¡ (í† ê¸€)

**ë‹¨ì¼ íŠ¸ëœì­ì…˜**:
1. ê¸°ì¡´ ë°˜ì‘ ì¡°íšŒ
2. ì—†ìœ¼ë©´ INSERT
3. ê°™ì€ íƒ€ì…ì´ë©´ DELETE (í† ê¸€ off)
4. ë‹¤ë¥¸ íƒ€ì…ì´ë©´ UPDATE `reaction_type` (ë³€ê²½)
5. `audit_logs` ê¸°ë¡ (ì‚¬ìš©ì í–‰ë™ ë¡œê·¸, ë³´ê´€ ê¸°ê°„ 90ì¼)

### 5.4 ì¡°íšŒìˆ˜ ì¦ê°€

**ë‹¨ì¼ íŠ¸ëœì­ì…˜**:
1. `viewed_bucket` ê³„ì‚° (30ë¶„ ë²„í‚·)
2. `content_views_dedup` INSERT ì‹œë„
3. **ì„±ê³µ ì‹œì—ë§Œ** `contents.view_count += 1`
4. ì‹¤íŒ¨ ì‹œ (ì¤‘ë³µ í‚¤) ì•„ë¬´ ì‘ì—… ì•ˆ í•¨

### 5.5 ì´ë²¤íŠ¸ ë‹¹ì²¨ì ì¶”ì²¨

**ë‹¨ì¼ íŠ¸ëœì­ì…˜**:
1. ì°¸ì—¬ì ì¤‘ ëœë¤ ì„ ì • (PostgreSQL `RANDOM()`)
2. `event_participants.is_winner = TRUE` ì—…ë°ì´íŠ¸
3. `audit_logs` ê¸°ë¡ (ë‹¹ì²¨ì ëª©ë¡ JSON)

---

## 6. ë°±ì—…/ë³´ê´€/ì •ë¦¬ ì •ì±…

### 6.1 PostgreSQL ë°±ì—…
- **ì •ì±…**: ì¼ 1íšŒ Full Backup + WAL ì•„ì¹´ì´ë¹™ (ê°€ëŠ¥ ì‹œ)
- **ë³´ê´€**: 30ì¼ (ê¸°ë³¸), ì›”ê°„ ë°±ì—… 12ê°œ (ì„ íƒ)
- **ë„êµ¬**: `pg_dump` + `pg_basebackup`

### 6.2 ë¡œê·¸/í–‰ë™ ë°ì´í„° ë³´ê´€
- `audit_logs`: 1ë…„
- `content_views_dedup`: 90ì¼ (ì´í›„ ì‚­ì œ/íŒŒí‹°ì…˜ ì •ë¦¬)
- `visitor_logs`: 1ë…„

### 6.3 íŒŒí‹°ì…”ë‹ (ì„ íƒì´ì§€ë§Œ ê¶Œì¥)
- `audit_logs`: ì›”ë³„ íŒŒí‹°ì…˜ (`created_at` ê¸°ì¤€)
- `content_views_dedup`: ì›”ë³„ íŒŒí‹°ì…˜ (`created_at` ê¸°ì¤€)
- PostgreSQL 12+ Declarative Partitioning í™œìš©

---

## 7. API ëª…ì„¸ (v1.2 ë³€ê²½ì‚¬í•­ ë°˜ì˜)

### 7.1 ì£¼ìš” ë³€ê²½ì‚¬í•­
1. **ì¡°íšŒìˆ˜**: `GET /api/contents/{id}` í˜¸ì¶œ ì‹œ dedup ì •ì±… ì ìš© (30ë¶„ 1íšŒ)
2. **ë°˜ì‘**: ë‹¨ì¼ ì„ íƒ + í† ê¸€ ë°©ì‹
3. **ì»¨í…ì¸  ìƒíƒœ**: `DRAFT`, `PUBLISHED`, `SCHEDULED`, `ARCHIVED`
4. **ì´ë²¤íŠ¸/íŒì—…**: `start_at`, `end_at` (TIMESTAMP)
5. **íŒŒì¼ ì—…ë¡œë“œ**: SHA256 ë¬´ê²°ì„± ê²€ì¦ ì‘ë‹µ ì¶”ê°€

### 7.2 ì¸ì¦ API

#### POST /api/auth/login
OAuth 2.0 ë¡œê·¸ì¸

**ìš”ì²­**:
```json
{
  "code": "authorization_code",
  "redirectUri": "http://localhost:5173/callback"
}
```

**ì‘ë‹µ**:
```json
{
  "accessToken": "eyJhbG...",
  "refreshToken": "...",
  "expiresIn": 3600,
  "user": {
    "userId": 1,
    "username": "john.doe",
    "name": "í™ê¸¸ë™",
    "email": "john@kz.com",
    "role": "USER"
  }
}
```

#### GET /api/auth/me
í˜„ì¬ ì‚¬ìš©ì ì •ë³´

**ì‘ë‹µ**:
```json
{
  "userId": 1,
  "username": "john.doe",
  "name": "í™ê¸¸ë™",
  "email": "john@kz.com",
  "department": "ì´ë¬´ë¹„ì„œíŒ€",
  "role": "USER"
}
```

---

### 7.3 ì»¨í…ì¸  API

#### GET /api/contents
ëª©ë¡ ì¡°íšŒ

**íŒŒë¼ë¯¸í„°**:
- `page`: í˜ì´ì§€ ë²ˆí˜¸ (0ë¶€í„°)
- `size`: í˜ì´ì§€ í¬ê¸° (ê¸°ë³¸ê°’ 12)
- `sort`: ì •ë ¬ (`publishedAt,desc` | `viewCount,desc` | `averageRating,desc`)
- `categoryId`: ì¹´í…Œê³ ë¦¬ ID
- `hashtag`: í•´ì‹œíƒœê·¸ ì´ë¦„ (ì‰¼í‘œ êµ¬ë¶„)
- `q`: ê²€ìƒ‰ì–´ (FTS ì‚¬ìš©)
- `status`: ìƒíƒœ í•„í„° (ê¸°ë³¸ê°’ `PUBLISHED`)

**ì‘ë‹µ**:
```json
{
  "content": [
    {
      "contentId": 1,
      "title": "2025ë…„ ì‹ ë…„ì‚¬",
      "summary": "ìƒˆí•´ë¥¼ ë§ì´í•˜ì—¬...",
      "thumbnailUrl": "/uploads/2025/01/abc-uuid.jpg",
      "categoryName": "Special",
      "hashtags": ["ì‹ ë…„", "CEO"],
      "viewCount": 1523,
      "averageRating": 4.5,
      "publishedAt": "2025-01-01T09:00:00"
    }
  ],
  "totalElements": 48,
  "totalPages": 4
}
```

#### GET /api/contents/{id}
ìƒì„¸ ì¡°íšŒ (**ì¡°íšŒìˆ˜ ìë™ ì¦ê°€, dedup ì ìš©**)

**ì‘ë‹µ**:
```json
{
  "contentId": 1,
  "title": "2025ë…„ ì‹ ë…„ì‚¬",
  "bodyHtml": "<h1>ì‹ ë…„ì‚¬</h1><p>...</p>",
  "categoryName": "Special",
  "hashtags": ["ì‹ ë…„", "CEO"],
  "viewCount": 1524,
  "averageRating": 4.5,
  "ratingCount": 120,
  "reactions": {
    "LIKE": 45,
    "SAD": 2,
    "ANGRY": 0,
    "FUNNY": 10
  },
  "userReaction": "LIKE",  // í˜„ì¬ ì‚¬ìš©ì ë°˜ì‘ (ì—†ìœ¼ë©´ null)
  "userRating": 5,         // í˜„ì¬ ì‚¬ìš©ì ë³„ì  (ì—†ìœ¼ë©´ null)
  "author": {
    "userId": 5,
    "name": "í™ê¸¸ë™"
  },
  "publishedAt": "2025-01-01T09:00:00"
}
```

#### POST /api/contents/{id}/reaction
ë°˜ì‘ ë“±ë¡/í† ê¸€ (**v1.2: ë‹¨ì¼ ì„ íƒ**)

**ìš”ì²­**:
```json
{
  "reactionType": "LIKE"  // LIKE, SAD, ANGRY, FUNNY
}
```

**ì‘ë‹µ**:
```json
{
  "action": "added",  // added, removed, changed
  "currentReaction": "LIKE",
  "reactions": {
    "LIKE": 46,
    "SAD": 2,
    "ANGRY": 0,
    "FUNNY": 10
  }
}
```

**ë™ì‘**:
- ê¸°ì¡´ ë°˜ì‘ ì—†ìŒ: `added`
- ê°™ì€ ë°˜ì‘ ì¬í´ë¦­: `removed` (ì‚­ì œ)
- ë‹¤ë¥¸ ë°˜ì‘ í´ë¦­: `changed` (ë³€ê²½)

---

### 7.4 íŒŒì¼ ì—…ë¡œë“œ API

#### POST /api/files/upload
íŒŒì¼ ì—…ë¡œë“œ (**v1.2: SHA256 ê²€ì¦**)

**ìš”ì²­**: `multipart/form-data`

**ì‘ë‹µ**:
```json
{
  "fileId": 123,
  "url": "/uploads/2025/01/abc-uuid-123.jpg",
  "originalName": "photo.jpg",
  "size": 1024000,
  "mimeType": "image/jpeg",
  "sha256": "a3f2c1d4..."
}
```

---

### 7.5 ì´ë²¤íŠ¸ API

#### GET /api/events
ì´ë²¤íŠ¸ ëª©ë¡

**íŒŒë¼ë¯¸í„°**:
- `status`: `active` (ì§„í–‰ì¤‘), `ended`, `all`

**ì‘ë‹µ**:
```json
{
  "content": [
    {
      "eventId": 1,
      "title": "ì„¤ë¬¸ì¡°ì‚¬ ì´ë²¤íŠ¸",
      "startAt": "2025-01-10T00:00:00",
      "endAt": "2025-01-31T23:59:59",
      "participantCount": 245,
      "isParticipated": false
    }
  ]
}
```

#### POST /api/events/{id}/draw
ë‹¹ì²¨ì ì¶”ì²¨ (ê´€ë¦¬ì ì „ìš©)

**ìš”ì²­**:
```json
{
  "winnerCount": 10
}
```

**ì‘ë‹µ**:
```json
{
  "winners": [
    {"userId": 12, "name": "í™ê¸¸ë™", "department": "ì´ë¬´ë¹„ì„œíŒ€"}
  ],
  "message": "10 winners selected"
}
```

---

## 8. í”„ë¡œì íŠ¸ êµ¬ì¡°

```
kz-magazine-platform/
â”‚
â”œâ”€â”€ backend/                          # Spring Boot API
â”‚   â”œâ”€â”€ src/main/java/com/kz/magazine/
â”‚   â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”‚   â”œâ”€â”€ SecurityConfig.java   # OAuth 2.0, JWT
â”‚   â”‚   â”‚   â”œâ”€â”€ FlywayConfig.java     # Flyway ì„¤ì •
â”‚   â”‚   â”‚   â””â”€â”€ CorsConfig.java
â”‚   â”‚   â”œâ”€â”€ controller/
â”‚   â”‚   â”œâ”€â”€ service/
â”‚   â”‚   â”œâ”€â”€ repository/
â”‚   â”‚   â”œâ”€â”€ entity/
â”‚   â”‚   â”œâ”€â”€ dto/
â”‚   â”‚   â”œâ”€â”€ security/
â”‚   â”‚   â””â”€â”€ util/
â”‚   â”œâ”€â”€ src/main/resources/
â”‚   â”‚   â”œâ”€â”€ application.yml
â”‚   â”‚   â””â”€â”€ db/migration/             # Flyway ë§ˆì´ê·¸ë ˆì´ì…˜
â”‚   â”‚       â”œâ”€â”€ V1__create_initial_schema.sql
â”‚   â”‚       â”œâ”€â”€ V2__add_audit_logs.sql
â”‚   â”‚       â””â”€â”€ V3__add_content_views_dedup.sql
â”‚   â””â”€â”€ build.gradle
â”‚
â”œâ”€â”€ frontend/                         # React SPA
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ contexts/
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ App.jsx
â”‚   â”‚   â””â”€â”€ main.jsx
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ vite.config.js
â”‚
â””â”€â”€ uploads/                          # ë¡œì»¬ íŒŒì¼ ì €ì¥ì†Œ
    â””â”€â”€ YYYY/MM/                      # ì›”ë³„ ë””ë ‰í† ë¦¬
```

---

## 9. ê°œë°œ ë‹¨ê³„ë³„ ê³„íš

### Phase 1: ê¸°ë³¸ ì¸í”„ë¼ (1ì£¼ì°¨)
- [ ] Spring Boot í”„ë¡œì íŠ¸ ìƒì„± + Flyway ì„¤ì •
- [ ] PostgreSQL ì„¤ì¹˜ ë° ì—°ê²°
- [ ] Flyway ë§ˆì´ê·¸ë ˆì´ì…˜: V1 (ê¸°ë³¸ ìŠ¤í‚¤ë§ˆ)
- [ ] React í”„ë¡œì íŠ¸ ìƒì„± (Vite)
- [ ] OAuth 2.0 Mock ì¸ì¦ êµ¬í˜„
- [ ] ë©”ì¸ í˜ì´ì§€ ë ˆì´ì•„ì›ƒ

### Phase 2: ì»¨í…ì¸  ê¸°ë³¸ ê¸°ëŠ¥ (2ì£¼ì°¨)
- [ ] ì»¨í…ì¸  CRUD API
- [ ] ì¡°íšŒìˆ˜ dedup ë¡œì§ êµ¬í˜„
- [ ] íŒŒì¼ ì—…ë¡œë“œ API (UUID, SHA256)
- [ ] HTML Sanitization (OWASP)
- [ ] React ì‚¬ë³´ ëª©ë¡/ìƒì„¸ í˜ì´ì§€
- [ ] ê´€ë¦¬ì ì»¨í…ì¸  ì‘ì„± (React-Quill)

### Phase 3: í™•ì¥ ê¸°ëŠ¥ (3ì£¼ì°¨)
- [ ] YouTube/Instagram API ì—°ë™
- [ ] ì´ë²¤íŠ¸ CRUD + ë‹¹ì²¨ì ì¶”ì²¨
- [ ] ë°˜ì‘/ë³„ì  API (ë‹¨ì¼ ì„ íƒ + í† ê¸€)
- [ ] Audit Log ê¸°ë¡
- [ ] React ì†Œì…œ/ì´ë²¤íŠ¸ í˜ì´ì§€

### Phase 4: ëŒ€ì‹œë³´ë“œ ë° ìµœì í™” (4ì£¼ì°¨)
- [ ] ëŒ€ì‹œë³´ë“œ í†µê³„ API
- [ ] FTS (Full-Text Search) êµ¬í˜„
- [ ] í•´ì‹œíƒœê·¸ ì¬ì§‘ê³„ ë°°ì¹˜
- [ ] Naver Analytics ì—°ë™
- [ ] React ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ (Recharts)

### Phase 5: í…ŒìŠ¤íŠ¸ ë° ë°°í¬ (5ì£¼ì°¨)
- [ ] SSO ì‹¤ì œ ì—°ë™
- [ ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
- [ ] í¬ë¡œìŠ¤ ë¸Œë¼ìš°ì§• í…ŒìŠ¤íŠ¸
- [ ] ìš´ì˜ ë§¤ë‰´ì–¼ ì‘ì„±
- [ ] ë°°í¬ ê°€ì´ë“œ

---

## 10. ê²°ë¡ 

### í•µì‹¬ ê²°ì • ì‚¬í•­ (v1.2 í™•ì •)
1. âœ… **Frontend**: React 18+ SPA
2. âœ… **SSO**: OAuth 2.0 (OIDC) + JWT
3. âœ… **DB ë§ˆì´ê·¸ë ˆì´ì…˜**: Flyway í•„ìˆ˜
4. âœ… **Soft Delete**: í•µì‹¬ ì—”í‹°í‹° ê¸°ë³¸
5. âœ… **ì¡°íšŒìˆ˜**: 30ë¶„ TTL dedup í…Œì´ë¸”
6. âœ… **ë°˜ì‘**: ë‹¨ì¼ ì„ íƒ + í† ê¸€
7. âœ… **ì»¨í…ì¸  ìƒíƒœ**: DRAFT/PUBLISHED/SCHEDULED/ARCHIVED
8. âœ… **ì´ë²¤íŠ¸/íŒì—…**: TIMESTAMP ê¸°ê°„
9. âœ… **í•´ì‹œíƒœê·¸**: íŠ¸ëœì­ì…˜ ì¦ê° + ì•¼ê°„ ì¬ì§‘ê³„
10. âœ… **Audit**: append-only ë¡œê·¸

### ë¬¸ì œ ì—¬ì§€ ì œê±° ì²´í¬ë¦¬ìŠ¤íŠ¸
- [x] ì‚­ì œ ì •ì±… ê³ ì • (Soft Delete)
- [x] ë°˜ì‘ ì •ì±… ê³ ì • (ë‹¨ì¼ ì„ íƒ)
- [x] ì¡°íšŒìˆ˜ ì¤‘ë³µ ë°©ì§€ (dedup í…Œì´ë¸”)
- [x] í•´ì‹œíƒœê·¸ ì •í•©ì„± (íŠ¸ëœì­ì…˜ + ë°°ì¹˜)
- [x] ì»¨í…ì¸  ìƒíƒœ ëª¨ë¸ (ENUM)
- [x] ì´ë²¤íŠ¸/íŒì—… ê¸°ê°„ (TIMESTAMP)
- [x] ê°ì‚¬ ë¡œê·¸ (audit_logs)
- [x] ì „ë¬¸ ê²€ìƒ‰ (FTS)
- [x] íŒŒì¼ ë¬´ê²°ì„± (SHA256)
- [x] ë§ˆì´ê·¸ë ˆì´ì…˜ (Flyway)

---

**ë¬¸ì„œ ë²„ì „**: v1.2 (DB ì •ì±… ê°•í™” + React ê¸°ë°˜)  
**ìµœì¢… ìˆ˜ì •ì¼**: 2025-12-26  
**ì‘ì„±ì**: Claude (Anthropic)
